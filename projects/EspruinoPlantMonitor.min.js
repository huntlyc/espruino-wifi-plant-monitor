function NetworkSave(t){var e=this;this.data=t,this.wifi=require("EspruinoWiFi"),this.wifi.connect(CONFIG.wifi.name,CONFIG.wifi.options,function(t){if(t)return void(CODE_DEBUG&&console.log("Connection error: "+t));CODE_DEBUG&&console.log("Connected!"),e.sendInfo(e.data)})}function PlantMonitor(){this.ow=new OneWire(B1),this.tempSensor=require("DS18B20").connect(this.ow),this.intervalVal=6e4,this.currentTimeoutID=void 0,this.monitor()}var CONFIG=void 0,CODE_DEBUG=!1;NetworkSave.prototype.jsonToQueryString=function(t){return""+Object.keys(t).map(function(e){return encodeURIComponent(e)+"="+encodeURIComponent(t[e])}).join("&")},NetworkSave.prototype.sendInfo=function(t){var e=this;t.auth=CONFIG.plantEndpoint.secret_token,content=this.jsonToQueryString(t);var o=CONFIG.plantEndpoint;o.headers["Content-Length"]=content.length;require("http").request(o,function(t){t.on("data",function(t){CODE_DEBUG&&console.log("HTTP> "+t)}),t.on("close",function(t){CODE_DEBUG&&console.log("HTTP Request Closed"),e.wifi.disconnect()})}).end(content)},PlantMonitor.prototype.getMoistureLevel=function(){var t=0,e=analogRead(B0);return isNaN(e)||(t=Math.round(100*e),t=100-t),t},PlantMonitor.prototype.monitor=function(){this.getSensorJSON(),this.setupNextCheckInterval()},PlantMonitor.prototype.getSensorJSON=function(){var t={moisture:-1,temperature:-1};t.moisture=this.getMoistureLevel(),this.tempSensor.getTemp(function(e){t.temperature=e,new NetworkSave(t)})},PlantMonitor.prototype.getSensorInfo=function(){var t=this.getMoistureLevel();console.log("Soil is "+t+"% saturated"),this.tempSensor.getTemp(function(t){console.log("amb tmp is "+t+"Â°C")})},PlantMonitor.prototype.setupNextCheckInterval=function(){var t=this;void 0!==this.currentTimeoutID&&clearTimeout(this.currentTimeoutID),this.currentTimeoutID=setTimeout(function(){t.monitor()},this.intervalVal)},setTimeout(function(){CODE_DEBUG&&console.log("starting"),CONFIG=require("projectConfig").config;new PlantMonitor},1e3);